#!/bin/sh
root_path=${PWD}

name=$(lein print :name | sed 's|"||g')
version=$(lein print :version | sed 's|"||g')

# https://www.graalvm.org/22.0/reference-manual/native-image/Agent/
native-image \
    --verbose \
    --enable-url-protocols=file,https,http \
    --report-unsupported-elements-at-runtime \
    --no-fallback \
    --enable-all-security-services \
    --no-server \
    --report-unsupported-elements-at-runtime \
    --static \
    --libc=musl \
    -H:+ReportExceptionStackTraces \
    -H:+JNI \
    -H:Name="${name}" \
    -jar target/uberjar/${name}-${version}-standalone.jar \
    --initialize-at-build-time=buddy.util \
    --initialize-at-build-time=java.lang \
    --initialize-at-build-time=java.lang.reflect \
    --initialize-at-build-time=java.sql \
    --initialize-at-build-time=java.util \
    --initialize-at-build-time=cheshire \
    --initialize-at-build-time=cheshire.generate \
    --initialize-at-build-time=cheshire.prettyprint \
    --initialize-at-build-time=clj_http.lite \
    --initialize-at-build-time=clojure.asm \
    --initialize-at-build-time=clojure.asm.commons \
    --initialize-at-build-time=clojure \
    --initialize-at-build-time=clojure.core \
    --initialize-at-build-time=clojure.core.protocols \
    --initialize-at-build-time=clojure.core.proxy$clojure.lang \
    --initialize-at-build-time=clojure.core.proxy$java.io \
    --initialize-at-build-time=clojure.core.reducers \
    --initialize-at-build-time=clojure.data \
    --initialize-at-build-time=clojure.inspector.proxy$java.lang \
    --initialize-at-build-time=clojure.inspector.proxy$javax.swing.table \
    --initialize-at-build-time=clojure.instant.proxy$java.lang \
    --initialize-at-build-time=clojure.java.api \
    --initialize-at-build-time=clojure.java.browse_ui.proxy$java.lang \
    --initialize-at-build-time=clojure.java \
    --initialize-at-build-time=clojure.java.io \
    --initialize-at-build-time=clojure.lang \
    --initialize-at-build-time=clojure.pprint \
    --initialize-at-build-time=clojure.pprint.proxy$java.io \
    --initialize-at-build-time=clojure.reflect \
    --initialize-at-build-time=clojure.reflect.proxy$clojure.asm \
    --initialize-at-build-time=clojure.repl.proxy$java.io \
    --initialize-at-build-time=clojure.repl.proxy$java.lang \
    --initialize-at-build-time=clojure.spec.alpha \
    --initialize-at-build-time=clojure.spec \
    --initialize-at-build-time=clojure.spec.gen \
    --initialize-at-build-time=clojure.spec.test \
    --initialize-at-build-time=clojure.test \
    --initialize-at-build-time=clojure.tools \
    --initialize-at-build-time=clojure.tools.logging \
    --initialize-at-build-time=clojure.tools.logging.impl \
    --initialize-at-build-time=clojure.tools.logging.proxy$java.io \
    --initialize-at-build-time=clojure.xml.proxy$java.lang \
    --initialize-at-build-time=com.fasterxml.jackson.core.async \
    --initialize-at-build-time=com.fasterxml.jackson.core.base \
    --initialize-at-build-time=com.fasterxml.jackson.core \
    --initialize-at-build-time=com.fasterxml.jackson.core.exc \
    --initialize-at-build-time=com.fasterxml.jackson.core.filter \
    --initialize-at-build-time=com.fasterxml.jackson.core.format \
    --initialize-at-build-time=com.fasterxml.jackson.core.io \
    --initialize-at-build-time=com.fasterxml.jackson.core.json.async \
    --initialize-at-build-time=com.fasterxml.jackson.core.json \
    --initialize-at-build-time=com.fasterxml.jackson.core.sym \
    --initialize-at-build-time=com.fasterxml.jackson.core.type \
    --initialize-at-build-time=com.fasterxml.jackson.core.util \
    --initialize-at-build-time=com.fasterxml.jackson.dataformat.cbor \
    --initialize-at-build-time=com.fasterxml.jackson.dataformat.cbor.databind \
    --initialize-at-build-time=com.fasterxml.jackson.dataformat.smile.async \
    --initialize-at-build-time=com.fasterxml.jackson.dataformat.smile \
    --initialize-at-build-time=com.fasterxml.jackson.dataformat.smile.databind \
    --initialize-at-build-time=jks_example$fn__1422.class \
    --initialize-at-build-time=jks_example$loading__6789__auto____1420.class \
    --initialize-at-build-time=jks_example$make_ssl_context.class \
    --initialize-at-build-time=module-info.class \
    --initialize-at-build-time=next \
    --initialize-at-build-time=next.jdbc \
    --initialize-at-build-time=next.jdbc.prepare \
    --initialize-at-build-time=next.jdbc.protocols \
    --initialize-at-build-time=next.jdbc.result_set \
    --initialize-at-build-time=onecli \
    --initialize-at-build-time=org.apache.commons.codec.binary \
    --initialize-at-build-time=org.apache.commons.codec \
    --initialize-at-build-time=org.apache.commons.codec.cli \
    --initialize-at-build-time=org.apache.commons.codec.digest \
    --initialize-at-build-time=org.apache.commons.codec.language.bm \
    --initialize-at-build-time=org.apache.commons.codec.language \
    --initialize-at-build-time=org.apache.commons.codec.net \
    --initialize-at-build-time=org.writequit.tigris \
    --initialize-at-build-time=serovers \
    --initialize-at-build-time=serovers.core \
    --initialize-at-build-time=slingshot \
    --initialize-at-build-time=zic \
    --initialize-at-build-time=zic.session \
    --initialize-at-build-time=org.h2.api \
    --initialize-at-build-time=org.h2.bnf \
    --initialize-at-build-time=org.h2.bnf.context \
    --initialize-at-build-time=org.h2 \
    --initialize-at-build-time=org.h2.command \
    --initialize-at-build-time=org.h2.command.ddl \
    --initialize-at-build-time=org.h2.command.dml \
    --initialize-at-build-time=org.h2.compress \
    --initialize-at-build-time=org.h2.constraint \
    --initialize-at-build-time=org.h2.engine \
    --initialize-at-build-time=org.h2.expression \
    --initialize-at-build-time=org.h2.fulltext \
    --initialize-at-build-time=org.h2.index \
    --initialize-at-build-time=org.h2.jdbc \
    --initialize-at-build-time=org.h2.jdbcx \
    --initialize-at-build-time=org.h2.jmx \
    --initialize-at-build-time=org.h2.message \
    --initialize-at-build-time=org.h2.mvstore.cache \
    --initialize-at-build-time=org.h2.mvstore \
    --initialize-at-build-time=org.h2.mvstore.db \
    --initialize-at-build-time=org.h2.mvstore.rtree \
    --initialize-at-build-time=org.h2.mvstore.type \
    --initialize-at-build-time=org.h2.result \
    --initialize-at-build-time=org.h2.schema \
    --initialize-at-build-time=org.h2.security \
    --initialize-at-build-time=org.h2.server \
    --initialize-at-build-time=org.h2.server.pg \
    --initialize-at-build-time=org.h2.server.web \
    --initialize-at-build-time=org.h2.store \
    --initialize-at-build-time=org.h2.store.fs \
    --initialize-at-build-time=org.h2.table \
    --initialize-at-build-time=org.h2.tools \
    --initialize-at-build-time=org.h2.upgrade \
    --initialize-at-build-time=org.h2.util \
    --initialize-at-build-time=org.h2.value \
    --initialize-at-build-time=org.bouncycastle.asn1.anssi \
    --initialize-at-build-time=org.bouncycastle.asn1.bc \
    --initialize-at-build-time=org.bouncycastle.asn1.bsi \
    --initialize-at-build-time=org.bouncycastle.asn1 \
    --initialize-at-build-time=org.bouncycastle.asn1.cmc \
    --initialize-at-build-time=org.bouncycastle.asn1.cmp \
    --initialize-at-build-time=org.bouncycastle.asn1.cms \
    --initialize-at-build-time=org.bouncycastle.asn1.cms.ecc \
    --initialize-at-build-time=org.bouncycastle.asn1.crmf \
    --initialize-at-build-time=org.bouncycastle.asn1.cryptlib \
    --initialize-at-build-time=org.bouncycastle.asn1.cryptopro \
    --initialize-at-build-time=org.bouncycastle.asn1.dvcs \
    --initialize-at-build-time=org.bouncycastle.asn1.eac \
    --initialize-at-build-time=org.bouncycastle.asn1.edec \
    --initialize-at-build-time=org.bouncycastle.asn1.esf \
    --initialize-at-build-time=org.bouncycastle.asn1.ess \
    --initialize-at-build-time=org.bouncycastle.asn1.est \
    --initialize-at-build-time=org.bouncycastle.asn1.gm \
    --initialize-at-build-time=org.bouncycastle.asn1.gnu \
    --initialize-at-build-time=org.bouncycastle.asn1.iana \
    --initialize-at-build-time=org.bouncycastle.asn1.icao \
    --initialize-at-build-time=org.bouncycastle.asn1.isara \
    --initialize-at-build-time=org.bouncycastle.asn1.isismtt \
    --initialize-at-build-time=org.bouncycastle.asn1.isismtt.ocsp \
    --initialize-at-build-time=org.bouncycastle.asn1.isismtt.x509 \
    --initialize-at-build-time=org.bouncycastle.asn1.iso \
    --initialize-at-build-time=org.bouncycastle.asn1.kisa \
    --initialize-at-build-time=org.bouncycastle.asn1.microsoft \
    --initialize-at-build-time=org.bouncycastle.asn1.misc \
    --initialize-at-build-time=org.bouncycastle.asn1.mozilla \
    --initialize-at-build-time=org.bouncycastle.asn1.nist \
    --initialize-at-build-time=org.bouncycastle.asn1.nsri \
    --initialize-at-build-time=org.bouncycastle.asn1.ntt \
    --initialize-at-build-time=org.bouncycastle.asn1.ocsp \
    --initialize-at-build-time=org.bouncycastle.asn1.oiw \
    --initialize-at-build-time=org.bouncycastle.asn1.pkcs \
    --initialize-at-build-time=org.bouncycastle.asn1.rosstandart \
    --initialize-at-build-time=org.bouncycastle.asn1.sec \
    --initialize-at-build-time=org.bouncycastle.asn1.smime \
    --initialize-at-build-time=org.bouncycastle.asn1.teletrust \
    --initialize-at-build-time=org.bouncycastle.asn1.tsp \
    --initialize-at-build-time=org.bouncycastle.asn1.ua \
    --initialize-at-build-time=org.bouncycastle.asn1.util \
    --initialize-at-build-time=org.bouncycastle.asn1.x500 \
    --initialize-at-build-time=org.bouncycastle.asn1.x500.style \
    --initialize-at-build-time=org.bouncycastle.asn1.x509 \
    --initialize-at-build-time=org.bouncycastle.asn1.x509.qualified \
    --initialize-at-build-time=org.bouncycastle.asn1.x509.sigi \
    --initialize-at-build-time=org.bouncycastle.asn1.x9 \
    --initialize-at-build-time=org.bouncycastle.cert.bc \
    --initialize-at-build-time=org.bouncycastle.cert \
    --initialize-at-build-time=org.bouncycastle.cert.cmp \
    --initialize-at-build-time=org.bouncycastle.cert.crmf.bc \
    --initialize-at-build-time=org.bouncycastle.cert.crmf \
    --initialize-at-build-time=org.bouncycastle.cert.crmf.jcajce \
    --initialize-at-build-time=org.bouncycastle.cert.dane \
    --initialize-at-build-time=org.bouncycastle.cert.dane.fetcher \
    --initialize-at-build-time=org.bouncycastle.cert.jcajce \
    --initialize-at-build-time=org.bouncycastle.cert.ocsp \
    --initialize-at-build-time=org.bouncycastle.cert.ocsp.jcajce \
    --initialize-at-build-time=org.bouncycastle.cert.path \
    --initialize-at-build-time=org.bouncycastle.cert.path.validations \
    --initialize-at-build-time=org.bouncycastle.cert.selector \
    --initialize-at-build-time=org.bouncycastle.cert.selector.jcajce \
    --initialize-at-build-time=org.bouncycastle \
    --initialize-at-build-time=org.bouncycastle.cmc \
    --initialize-at-build-time=org.bouncycastle.cms.bc \
    --initialize-at-build-time=org.bouncycastle.cms \
    --initialize-at-build-time=org.bouncycastle.cms.jcajce \
    --initialize-at-build-time=org.bouncycastle.crypto.agreement \
    --initialize-at-build-time=org.bouncycastle.crypto.agreement.jpake \
    --initialize-at-build-time=org.bouncycastle.crypto.agreement.kdf \
    --initialize-at-build-time=org.bouncycastle.crypto.agreement.srp \
    --initialize-at-build-time=org.bouncycastle.crypto \
    --initialize-at-build-time=org.bouncycastle.crypto.commitments \
    --initialize-at-build-time=org.bouncycastle.crypto.digests \
    --initialize-at-build-time=org.bouncycastle.crypto.ec \
    --initialize-at-build-time=org.bouncycastle.crypto.encodings \
    --initialize-at-build-time=org.bouncycastle.crypto.engines \
    --initialize-at-build-time=org.bouncycastle.crypto.examples \
    --initialize-at-build-time=org.bouncycastle.crypto.generators \
    --initialize-at-build-time=org.bouncycastle.crypto.io \
    --initialize-at-build-time=org.bouncycastle.crypto.kems \
    --initialize-at-build-time=org.bouncycastle.crypto.macs \
    --initialize-at-build-time=org.bouncycastle.crypto.modes \
    --initialize-at-build-time=org.bouncycastle.crypto.modes.gcm \
    --initialize-at-build-time=org.bouncycastle.crypto.modes.kgcm \
    --initialize-at-build-time=org.bouncycastle.crypto.paddings \
    --initialize-at-build-time=org.bouncycastle.crypto.params \
    --initialize-at-build-time=org.bouncycastle.crypto.parsers \
    --initialize-at-build-time=org.bouncycastle.crypto.prng \
    --initialize-at-build-time=org.bouncycastle.crypto.prng.drbg \
    --initialize-at-build-time=org.bouncycastle.crypto.signers \
    --initialize-at-build-time=org.bouncycastle.crypto.util \
    --initialize-at-build-time=org.bouncycastle.dvcs \
    --initialize-at-build-time=org.bouncycastle.eac \
    --initialize-at-build-time=org.bouncycastle.eac.jcajce \
    --initialize-at-build-time=org.bouncycastle.eac.operator \
    --initialize-at-build-time=org.bouncycastle.eac.operator.jcajce \
    --initialize-at-build-time=org.bouncycastle.est \
    --initialize-at-build-time=org.bouncycastle.est.jcajce \
    --initialize-at-build-time=org.bouncycastle.i18n \
    --initialize-at-build-time=org.bouncycastle.i18n.filter \
    --initialize-at-build-time=org.bouncycastle.iana \
    --initialize-at-build-time=org.bouncycastle.its.asn1 \
    --initialize-at-build-time=org.bouncycastle.jcajce \
    --initialize-at-build-time=org.bouncycastle.jcajce.interfaces \
    --initialize-at-build-time=org.bouncycastle.jcajce.io \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.dh \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.dsa \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.dstu \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.ec \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.ecgost12 \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.ecgost \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.edec \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.elgamal \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.gost \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.ies \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.rsa \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.util \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.asymmetric.x509 \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.config \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.digest \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.drbg \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.keystore.bc \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.keystore.bcfks \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.keystore \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.keystore.pkcs12 \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.symmetric \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.symmetric.util \
    --initialize-at-build-time=org.bouncycastle.jcajce.provider.util \
    --initialize-at-build-time=org.bouncycastle.jcajce.spec \
    --initialize-at-build-time=org.bouncycastle.jcajce.util \
    --initialize-at-build-time=org.bouncycastle.jce \
    --initialize-at-build-time=org.bouncycastle.jce.exception \
    --initialize-at-build-time=org.bouncycastle.jce.interfaces \
    --initialize-at-build-time=org.bouncycastle.jce.netscape \
    --initialize-at-build-time=org.bouncycastle.jce.provider \
    --initialize-at-build-time=org.bouncycastle.jce.spec \
    --initialize-at-build-time=org.bouncycastle.math \
    --initialize-at-build-time=org.bouncycastle.math.ec \
    --initialize-at-build-time=org.bouncycastle.math.ec.custom.djb \
    --initialize-at-build-time=org.bouncycastle.math.ec.custom.gm \
    --initialize-at-build-time=org.bouncycastle.math.ec.custom.sec \
    --initialize-at-build-time=org.bouncycastle.math.ec.endo \
    --initialize-at-build-time=org.bouncycastle.math.ec.rfc7748 \
    --initialize-at-build-time=org.bouncycastle.math.ec.rfc8032 \
    --initialize-at-build-time=org.bouncycastle.math.ec.tools \
    --initialize-at-build-time=org.bouncycastle.math.field \
    --initialize-at-build-time=org.bouncycastle.math.raw \
    --initialize-at-build-time=org.bouncycastle.mime \
    --initialize-at-build-time=org.bouncycastle.mime.encoding \
    --initialize-at-build-time=org.bouncycastle.mime.smime \
    --initialize-at-build-time=org.bouncycastle.mozilla \
    --initialize-at-build-time=org.bouncycastle.mozilla.jcajce \
    --initialize-at-build-time=org.bouncycastle.openssl.bc \
    --initialize-at-build-time=org.bouncycastle.openssl \
    --initialize-at-build-time=org.bouncycastle.openssl.jcajce \
    --initialize-at-build-time=org.bouncycastle.operator.bc \
    --initialize-at-build-time=org.bouncycastle.operator \
    --initialize-at-build-time=org.bouncycastle.operator.jcajce \
    --initialize-at-build-time=org.bouncycastle.pkcs.bc \
    --initialize-at-build-time=org.bouncycastle.pkcs \
    --initialize-at-build-time=org.bouncycastle.pkcs.jcajce \
    --initialize-at-build-time=org.bouncycastle.pkix \
    --initialize-at-build-time=org.bouncycastle.pkix.jcajce \
    --initialize-at-build-time=org.bouncycastle.pqc.asn1 \
    --initialize-at-build-time=org.bouncycastle.pqc.crypto \
    --initialize-at-build-time=org.bouncycastle.pqc.crypto.gmss \
    --initialize-at-build-time=org.bouncycastle.pqc.crypto.gmss.util \
    --initialize-at-build-time=org.bouncycastle.pqc.crypto.lms \
    --initialize-at-build-time=org.bouncycastle.pqc.crypto.mceliece \
    --initialize-at-build-time=org.bouncycastle.pqc.crypto.newhope \
    --initialize-at-build-time=org.bouncycastle.pqc.crypto.qtesla \
    --initialize-at-build-time=org.bouncycastle.pqc.crypto.rainbow \
    --initialize-at-build-time=org.bouncycastle.pqc.crypto.rainbow.util \
    --initialize-at-build-time=org.bouncycastle.pqc.crypto.sphincs \
    --initialize-at-build-time=org.bouncycastle.pqc.crypto.util \
    --initialize-at-build-time=org.bouncycastle.pqc.crypto.xmss \
    --initialize-at-build-time=org.bouncycastle.pqc.jcajce.interfaces \
    --initialize-at-build-time=org.bouncycastle.pqc.jcajce.provider \
    --initialize-at-build-time=org.bouncycastle.pqc.jcajce.provider.gmss \
    --initialize-at-build-time=org.bouncycastle.pqc.jcajce.provider.lms \
    --initialize-at-build-time=org.bouncycastle.pqc.jcajce.provider.mceliece \
    --initialize-at-build-time=org.bouncycastle.pqc.jcajce.provider.newhope \
    --initialize-at-build-time=org.bouncycastle.pqc.jcajce.provider.qtesla \
    --initialize-at-build-time=org.bouncycastle.pqc.jcajce.provider.rainbow \
    --initialize-at-build-time=org.bouncycastle.pqc.jcajce.provider.sphincs \
    --initialize-at-build-time=org.bouncycastle.pqc.jcajce.provider.util \
    --initialize-at-build-time=org.bouncycastle.pqc.jcajce.provider.xmss \
    --initialize-at-build-time=org.bouncycastle.pqc.jcajce.spec \
    --initialize-at-build-time=org.bouncycastle.pqc.math.linearalgebra \
    --initialize-at-build-time=org.bouncycastle.tsp \
    --initialize-at-build-time=org.bouncycastle.tsp.cms \
    --initialize-at-build-time=org.bouncycastle.util \
    --initialize-at-build-time=org.bouncycastle.util.encoders \
    --initialize-at-build-time=org.bouncycastle.util.io \
    --initialize-at-build-time=org.bouncycastle.util.io.pem \
    --initialize-at-build-time=org.bouncycastle.util.test \
    --initialize-at-build-time=org.bouncycastle.voms \
    --initialize-at-build-time=org.bouncycastle.x509 \
    --initialize-at-build-time=org.bouncycastle.x509.extension \
    --initialize-at-build-time=org.bouncycastle.x509.util \
    --initialize-at-run-time=org.h2.util.MathUtils \
    --initialize-at-run-time=org.h2.engine.ConnectionInfo \
    --initialize-at-run-time=org.h2.engine.SysProperties \
    --initialize-at-run-time=org.h2.store.fs.FileNioMemData \
    --initialize-at-run-time=org.h2.value.ValueGeometry \
    -H:+AllowIncompleteClasspath \
    -J-Dclojure.compiler.direct-linking=true \
    -J-Dclojure.spec.skip-macros=true \
    -J-Xmx4G \
    "${@}"

