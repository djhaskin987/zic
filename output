+ rm -rf .zic.mv.db
+ rm -rf .zic.trace.db
+ rm -rf .staging
+ mkdir -p .staging
+ rm -rf a
+ rm -rf c
+ rm -rf changes
+ rm -rf failure
++ lein print :name
++ sed 's|"||g'
OpenJDK 64-Bit Server VM warning: forcing TieredStopAtLevel to full optimization because JVMCI is enabled
+ name=zic
++ lein print :version
++ sed 's|"||g'
OpenJDK 64-Bit Server VM warning: forcing TieredStopAtLevel to full optimization because JVMCI is enabled
+ version=0.1.0-SNAPSHOT
+ execmd=
+ java=java
+ '[' -n '' ']'
+ '[' -z '' ']'
+ execmd='java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar'
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar init
{"result":"successful"}
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar add --json-download-authorizations '{"djhaskin987.me": {"type": "basic", "username": "mode", "password": "code"}}' --set-package-name verybad --set-package-version 0.1.0 --set-package-location https://djhaskin987.me:8443/verybad.zip
{"zip-file":"java.util.zip.ZipFile@31120021","crc-violations":[{"path":"a.txt","stored-crc":0,"computed-crc":3633523372}],"error":"clojure.lang.ExceptionInfo: Zip file contains CRC violations. {:zip-file #object[java.util.zip.ZipFile 0x31120021 \"java.util.zip.ZipFile@31120021\"], :crc-violations [{:path \"a.txt\", :stored-crc 0, :computed-crc 3633523372}]}","stacktrace":"clojure.lang.ExceptionInfo: Zip file contains CRC violations. {:zip-file #object[java.util.zip.ZipFile 0x31120021 \"java.util.zip.ZipFile@31120021\"], :crc-violations [{:path \"a.txt\", :stored-crc 0, :computed-crc 3633523372}]}\n\tat zic.fs$unpack.invokeStatic(fs.clj:270)\n\tat zic.package$install_package_BANG_$fn__2907.invoke(package.clj:403)\n\tat zic.session$with_zic_session$fn__2664$fn__2665.invoke(session.clj:111)\n\tat zic.session$with_filelock.invokeStatic(session.clj:32)\n\tat zic.session$with_zic_session$fn__2664.invoke(session.clj:111)\n\tat zic.session$with_database.invokeStatic(session.clj:97)\n\tat zic.session$with_zic_session.invokeStatic(session.clj:106)\n\tat zic.package$install_package_BANG_.invokeStatic(package.clj:337)\n\tat zic.cli$add_BANG_.invokeStatic(cli.clj:48)\n\tat zic.cli$add_BANG_.invoke(cli.clj:48)\n\tat clojure.lang.Var.invoke(Var.java:384)\n\tat onecli.core$go_BANG_.invokeStatic(core.clj:627)\n\tat zic.cli$run.invokeStatic(cli.clj:275)\n\tat zic.cli$_main.invokeStatic(cli.clj:314)\n\tat zic.cli$_main.doInvoke(cli.clj:314)\n\tat clojure.lang.RestFn.applyTo(RestFn.java:137)\n\tat zic.cli.main(Unknown Source)\n","given-options":{"package-version":"0.1.0","start-directory":"/home/djhaskin987/Development/src/zic","cascade":false,"package-location":"https://djhaskin987.me:8443/verybad.zip","commands":["add"],"download-package":true,"dry-run":false,"download-authorizations":{"djhaskin987.me":{"type":"basic","username":"mode","password":"code"}},"package-name":"verybad"}}
+ touch .staging/a-0.1.0.zip
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar add --json-download-authorizations '{"djhaskin987.me": {"type": "basic", "username": "mode", "password": "code"}}' --set-package-name a --set-package-version 0.1.0 --set-package-location https://djhaskin987.me:8443/a.zip --set-package-metadata '{"zic": {"config-files": ["a/poem.txt"], "ghost-files": ["a/log.txt"]}}'
{"error":"java.util.zip.ZipException: zip file is empty","problem":"unknown-problem","stacktrace":"java.util.zip.ZipException: zip file is empty\n\tat java.base/java.util.zip.ZipFile$Source.zerror(ZipFile.java:1581)\n\tat java.base/java.util.zip.ZipFile$Source.findEND(ZipFile.java:1389)\n\tat java.base/java.util.zip.ZipFile$Source.initCEN(ZipFile.java:1483)\n\tat java.base/java.util.zip.ZipFile$Source.<init>(ZipFile.java:1288)\n\tat java.base/java.util.zip.ZipFile$Source.get(ZipFile.java:1251)\n\tat java.base/java.util.zip.ZipFile$CleanableResource.<init>(ZipFile.java:732)\n\tat java.base/java.util.zip.ZipFile$CleanableResource.get(ZipFile.java:849)\n\tat java.base/java.util.zip.ZipFile.<init>(ZipFile.java:247)\n\tat java.base/java.util.zip.ZipFile.<init>(ZipFile.java:177)\n\tat java.base/java.util.zip.ZipFile.<init>(ZipFile.java:191)\n\tat java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n\tat java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:490)\n\tat clojure.lang.Reflector.invokeConstructor(Reflector.java:305)\n\tat zic.package$download_package_BANG_.invokeStatic(package.clj:103)\n\tat zic.package$install_package_BANG_$fn__2907.invoke(package.clj:363)\n\tat zic.session$with_zic_session$fn__2664$fn__2665.invoke(session.clj:111)\n\tat zic.session$with_filelock.invokeStatic(session.clj:32)\n\tat zic.session$with_zic_session$fn__2664.invoke(session.clj:111)\n\tat zic.session$with_database.invokeStatic(session.clj:97)\n\tat zic.session$with_zic_session.invokeStatic(session.clj:106)\n\tat zic.package$install_package_BANG_.invokeStatic(package.clj:337)\n\tat zic.cli$add_BANG_.invokeStatic(cli.clj:48)\n\tat zic.cli$add_BANG_.invoke(cli.clj:48)\n\tat clojure.lang.Var.invoke(Var.java:384)\n\tat onecli.core$go_BANG_.invokeStatic(core.clj:627)\n\tat zic.cli$run.invokeStatic(cli.clj:275)\n\tat zic.cli$_main.invokeStatic(cli.clj:314)\n\tat zic.cli$_main.doInvoke(cli.clj:314)\n\tat clojure.lang.RestFn.applyTo(RestFn.java:137)\n\tat zic.cli.main(Unknown Source)\n","given-options":{"package-version":"0.1.0","start-directory":"/home/djhaskin987/Development/src/zic","cascade":false,"package-location":"https://djhaskin987.me:8443/a.zip","commands":["add"],"download-package":true,"dry-run":false,"package-metadata":"{\"zic\": {\"config-files\": [\"a/poem.txt\"], \"ghost-files\": [\"a/log.txt\"]}}","download-authorizations":{"djhaskin987.me":{"type":"basic","username":"mode","password":"code"}},"package-name":"a"}}
+ rm -rf .staging/a-0.1.0.zip
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar add --json-download-authorizations '{"djhaskin987.me": {"type": "basic", "username": "mode", "password": "code"}}' --set-package-name a --set-package-version 0.1.0 --set-package-location https://djhaskin987.me:8443/a.zip --set-package-metadata '{"zic": {"config-files": ["a/poem.txt"], "ghost-files": ["a/log.txt"]}}'
{"result":"successful"}
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar verify --set-package-name a
{"result":"package-found","verification-results":{}}
+ sed -i s/w/W/g a/willows.txt
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar verify --set-package-name a
{"result":"package-found","verification-results":{"checksum-discrepancy":[{"target-checksum":"d717f5ca5627b3fdbecf4a0cbe27cdb019cb0670704f4df9310bc6be5039fcb2","source-checksum":"bf20da2e626d608e486160cad938868e588603cd91fa71b4b7f604a5a4e90dfd","path":"a/willows.txt"}]}}
+ sed -i s/W/w/g a/willows.txt
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar verify --set-package-name a
{"result":"package-found","verification-results":{}}
+ sed -i s/I/U/g a/poem.txt
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar verify --set-package-name a
{"result":"package-found","verification-results":{}}
+ rm -rf a/poem.txt
+ rm -rf a/willows.txt
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar verify --set-package-name a
{"result":"package-found","verification-results":{"config-file-missing":[{"path":"a/poem.txt"}],"file-missing":[{"path":"a/willows.txt"}]}}
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar add --set-package-name b --set-package-version 0.1.0 --set-package-location invalid,yetworks --set-package-metadata '{"for": "you"}' --disable-download-package
{"result":"successful"}
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar info --set-package-name a
{"result":"package-found","package-information":{"name":"a","version":"0.1.0","location":"https://djhaskin987.me:8443/a.zip","metadata":{"zic":{"config-files":["a/poem.txt"],"ghost-files":["a/log.txt"]}}}}
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar info --set-package-name b
{"result":"package-found","package-information":{"name":"b","version":"0.1.0","location":"invalid,yetworks","metadata":{"for":"you"}}}
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar info --set-package-name c
{"result":"not-found"}
+ mkdir c
+ echo 'I am NOT JUST an echo.'
+ touch c/echo.txt.c.0.1.0.new
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar add --json-download-authorizations '{"djhaskin987.me": {"type": "basic", "username": "mode", "password": "code"}}' --set-package-name c --set-package-version 0.1.0 --set-package-location https://djhaskin987.me:8443/c.zip --set-package-metadata '{"zic": {"config-files": ["c/echo.txt"]}}'
{"result":"successful"}
++ cat c/echo.txt
+ test 'I am NOT JUST an echo.' = 'I am NOT JUST an echo.'
+ test -f c/echo.txt
+ test -f c/echo.txt.c.0.1.0.new
+ test -f c/echo.txt.c.0.1.0.new.1
++ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar files --set-package-name a
+ '[' '{"result":"package-found","package-files":[{"path":"a/poem.txt","size":44,"file-class":"config-file","checksum":"f5804ac61aa4b37500ea52077f984d7224a35d3e2d05644d62ac4940384cfa6e"},{"path":"a/willows.txt","size":16,"file-class":"normal-file","checksum":"bf20da2e626d608e486160cad938868e588603cd91fa71b4b7f604a5a4e90dfd"},{"path":"a/log.txt","size":0,"file-class":"ghost-file","checksum":null}]}' '!=' '{"result":"package-found","package-files":[{"path":"a/poem.txt","size":44,"file-class":"config-file","checksum":"f5804ac61aa4b37500ea52077f984d7224a35d3e2d05644d62ac4940384cfa6e"},{"path":"a/willows.txt","size":16,"file-class":"normal-file","checksum":"bf20da2e626d608e486160cad938868e588603cd91fa71b4b7f604a5a4e90dfd"},{"path":"a/log.txt","size":0,"file-class":"ghost-file","checksum":null}]}' ']'
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar add --json-download-authorizations '{"djhaskin987.me": {"type": "basic", "username": "mode", "password": "code"}}' --set-package-name failure --set-package-version 0.2.0 --set-package-location https://djhaskin987.me:8443/failure-0.2.0.zip
{"result":"successful"}
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar add --json-download-authorizations '{"djhaskin987.me": {"type": "basic", "username": "mode", "password": "code"}}' --set-package-name failure --set-package-version 0.2.0 --set-package-location https://djhaskin987.me:8443/failure-0.2.0.zip
{"existing-version":"0.2.0","package-name":"failure","new-version":"0.2.0","error":"clojure.lang.ExceptionInfo: Option `allow-inplace` is disabled and in-place replacement detected. {:existing-version \"0.2.0\", :package-name \"failure\", :new-version \"0.2.0\"}","stacktrace":"clojure.lang.ExceptionInfo: Option `allow-inplace` is disabled and in-place replacement detected. {:existing-version \"0.2.0\", :package-name \"failure\", :new-version \"0.2.0\"}\n\tat zic.package$config_and_upgrade_precautions.invokeStatic(package.clj:154)\n\tat zic.package$install_package_BANG_$fn__2907.invoke(package.clj:375)\n\tat zic.session$with_zic_session$fn__2664$fn__2665.invoke(session.clj:111)\n\tat zic.session$with_filelock.invokeStatic(session.clj:32)\n\tat zic.session$with_zic_session$fn__2664.invoke(session.clj:111)\n\tat zic.session$with_database.invokeStatic(session.clj:97)\n\tat zic.session$with_zic_session.invokeStatic(session.clj:106)\n\tat zic.package$install_package_BANG_.invokeStatic(package.clj:337)\n\tat zic.cli$add_BANG_.invokeStatic(cli.clj:48)\n\tat zic.cli$add_BANG_.invoke(cli.clj:48)\n\tat clojure.lang.Var.invoke(Var.java:384)\n\tat onecli.core$go_BANG_.invokeStatic(core.clj:627)\n\tat zic.cli$run.invokeStatic(cli.clj:275)\n\tat zic.cli$_main.invokeStatic(cli.clj:314)\n\tat zic.cli$_main.doInvoke(cli.clj:314)\n\tat clojure.lang.RestFn.applyTo(RestFn.java:137)\n\tat zic.cli.main(Unknown Source)\n","given-options":{"package-version":"0.2.0","start-directory":"/home/djhaskin987/Development/src/zic","cascade":false,"package-location":"https://djhaskin987.me:8443/failure-0.2.0.zip","commands":["add"],"download-package":true,"dry-run":false,"download-authorizations":{"djhaskin987.me":{"type":"basic","username":"mode","password":"code"}},"package-name":"failure"}}
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar add --json-download-authorizations '{"djhaskin987.me": {"type": "basic", "username": "mode", "password": "code"}}' --set-package-name failure --set-package-version 0.1.0 --set-package-location https://djhaskin987.me:8443/failure-0.1.0.zip
{"existing-version":"0.2.0","package-name":"failure","new-version":"0.1.0","error":"clojure.lang.ExceptionInfo: Option `allow-downgrades` is disabled and downgrade detected. {:existing-version \"0.2.0\", :package-name \"failure\", :new-version \"0.1.0\"}","stacktrace":"clojure.lang.ExceptionInfo: Option `allow-downgrades` is disabled and downgrade detected. {:existing-version \"0.2.0\", :package-name \"failure\", :new-version \"0.1.0\"}\n\tat zic.package$config_and_upgrade_precautions.invokeStatic(package.clj:162)\n\tat zic.package$install_package_BANG_$fn__2907.invoke(package.clj:375)\n\tat zic.session$with_zic_session$fn__2664$fn__2665.invoke(session.clj:111)\n\tat zic.session$with_filelock.invokeStatic(session.clj:32)\n\tat zic.session$with_zic_session$fn__2664.invoke(session.clj:111)\n\tat zic.session$with_database.invokeStatic(session.clj:97)\n\tat zic.session$with_zic_session.invokeStatic(session.clj:106)\n\tat zic.package$install_package_BANG_.invokeStatic(package.clj:337)\n\tat zic.cli$add_BANG_.invokeStatic(cli.clj:48)\n\tat zic.cli$add_BANG_.invoke(cli.clj:48)\n\tat clojure.lang.Var.invoke(Var.java:384)\n\tat onecli.core$go_BANG_.invokeStatic(core.clj:627)\n\tat zic.cli$run.invokeStatic(cli.clj:275)\n\tat zic.cli$_main.invokeStatic(cli.clj:314)\n\tat zic.cli$_main.doInvoke(cli.clj:314)\n\tat clojure.lang.RestFn.applyTo(RestFn.java:137)\n\tat zic.cli.main(Unknown Source)\n","given-options":{"package-version":"0.1.0","start-directory":"/home/djhaskin987/Development/src/zic","cascade":false,"package-location":"https://djhaskin987.me:8443/failure-0.1.0.zip","commands":["add"],"download-package":true,"dry-run":false,"download-authorizations":{"djhaskin987.me":{"type":"basic","username":"mode","password":"code"}},"package-name":"failure"}}
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar add --json-download-authorizations '{"djhaskin987.me": {"type": "basic", "username": "mode", "password": "code"}}' --set-package-name failure --enable-allow-downgrades --set-package-version 0.1.0 --set-package-location https://djhaskin987.me:8443/failure-0.1.0.zip
{"result":"successful"}
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar remove --set-package-name failure
{"result":"package-found","dry-run":false,"removed-packages":[{"name":"failure","version":"0.1.0","location":"https://djhaskin987.me:8443/failure-0.1.0.zip","metadata":null}]}
++ find failure -type f
+ '[' -n '' ']'
+ rm -rf failure
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar add --json-download-authorizations '{"djhaskin987.me": {"type": "basic", "username": "mode", "password": "code"}}' --set-package-name failure --set-package-version 0.1.0 --set-package-location https://djhaskin987.me:8443/failure-0.1.0.zip
{"result":"successful"}
+ java -Djavax.net.ssl.trustStore=test.keystore -Djavax.net.ssl.trustStorePassword=asdfasdf -jar target/uberjar/zic-0.1.0-SNAPSHOT-standalone.jar add --json-download-authorizations '{"djhaskin987.me": {"type": "basic", "username": "mode", "password": "code"}}' --set-package-name failure --set-package-version 0.2.0 --set-package-location https://djhaskin987.me:8443/failure-0.2.0.zip
{"result":"successful"}
+ exit 1
